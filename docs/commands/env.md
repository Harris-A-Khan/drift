# drift env

Manage environment configuration and Xcode xcconfig generation.

## Usage

```bash
drift env <subcommand> [flags]
```

## Subcommands

| Subcommand | Description |
|------------|-------------|
| `show` | Show current environment info |
| `setup` | Generate Config.xcconfig for current branch |
| `switch` | Generate xcconfig for a specific Supabase branch |

## drift env show

Display the current environment configuration.

```bash
drift env show
```

**Output:**
```
╔══════════════════════════════════════════════════════════════╗
║  Environment Info                                            ║
╚══════════════════════════════════════════════════════════════╝

  Git Branch:       feature/new-ui
  Environment:      Feature
  Supabase Branch:  feature-new-ui
  Project Ref:      abcdefghij
  API URL:          https://abcdefghij.supabase.co

───── Xcconfig Status
  Config File:      Config.xcconfig
  Configured Env:   Feature
```

## drift env setup

Generate `Config.xcconfig` for the current git branch.

```bash
drift env setup [flags]
```

**Flags:**

| Flag | Description |
|------|-------------|
| `--branch`, `-b` | Override Supabase branch selection |
| `--build-server` | Also generate buildServer.json for sourcekit-lsp |
| `--scheme` | Xcode scheme to use for buildServer.json (requires --build-server) |

**What It Does:**

1. Detects current git branch
2. Resolves matching Supabase branch (or falls back to development)
3. Fetches anon key from Supabase
4. Generates `Config.xcconfig` with all credentials

**Example:**

```bash
$ drift env setup

  Resolving Supabase branch... ✓
  Fetching API keys... ✓
  Generating Config.xcconfig... ✓

  Environment:      Feature
  Supabase Branch:  feature-new-ui
  Project Ref:      abcdefghij
  Output:           Config.xcconfig
```

**With buildServer.json:**

```bash
# Auto-detect scheme based on environment
drift env setup --build-server

# Specify a specific scheme
drift env setup --build-server --scheme "MyApp (Development)"
```

This generates `buildServer.json` for sourcekit-lsp support in VS Code. By default, the scheme is auto-detected based on the current environment. Use `--scheme` to override this and specify exactly which Xcode scheme to use.

## drift env switch

Generate xcconfig for a specific Supabase branch, regardless of current git branch.

```bash
drift env switch <branch>
```

**Example:**

```bash
# Generate config for production while on a feature branch
drift env switch main
```

## Environment Types

Drift recognizes three environment types:

| Environment | Criteria | Color |
|-------------|----------|-------|
| Production | Default Supabase branch | Red |
| Development | Persistent non-default branch | Yellow |
| Feature | Ephemeral branch | Green |

## Generated xcconfig

The generated `Config.xcconfig` contains:

```
// Config.xcconfig
// Auto-generated by drift - DO NOT EDIT

// Supabase Configuration
SUPABASE_URL = https://abcdefghij.supabase.co
SUPABASE_ANON_KEY = eyJ...
SUPABASE_PROJECT_REF = abcdefghij

// Environment
DRIFT_ENVIRONMENT = Feature
DRIFT_GIT_BRANCH = feature/new-ui
DRIFT_SUPABASE_BRANCH = feature-new-ui
```

## See Also

- [Xcode Integration](../guides/xcode.md)
- [Configuration](../config/drift-yaml.md)
