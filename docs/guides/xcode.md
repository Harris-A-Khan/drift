# Xcode Integration

This guide explains how to integrate Drift-generated configuration into your Xcode project.

## Generated Files

Drift generates two xcconfig files:

| File | Purpose |
|------|---------|
| `Config.xcconfig` | Supabase credentials and environment info |
| `Version.xcconfig` | Marketing version and build number |

## Setting Up Config.xcconfig

### 1. Generate the Config

```bash
drift env setup
```

This creates `Config.xcconfig`:

```
// Config.xcconfig
// Auto-generated by drift - DO NOT EDIT

SUPABASE_URL = https://abcdefghij.supabase.co
SUPABASE_ANON_KEY = eyJ...
SUPABASE_PROJECT_REF = abcdefghij
DRIFT_ENVIRONMENT = Development
```

### 2. Add to Xcode Project

1. Drag `Config.xcconfig` into your Xcode project
2. Make sure "Copy items if needed" is unchecked
3. Add to your target

### 3. Configure Build Settings

Go to **Project → Info → Configurations** and set the configuration file:

| Configuration | File |
|---------------|------|
| Debug | Config.xcconfig |
| Release | Config.xcconfig |

Or include it in your existing xcconfig:

```
#include "Config.xcconfig"
```

### 4. Add to Info.plist

Add these keys to your `Info.plist`:

```xml
<key>SUPABASE_URL</key>
<string>$(SUPABASE_URL)</string>
<key>SUPABASE_ANON_KEY</key>
<string>$(SUPABASE_ANON_KEY)</string>
```

### 5. Access in Swift

```swift
import Foundation

enum Environment {
    static let supabaseURL: String = {
        guard let url = Bundle.main.infoDictionary?["SUPABASE_URL"] as? String else {
            fatalError("SUPABASE_URL not found in Info.plist")
        }
        return url
    }()

    static let supabaseAnonKey: String = {
        guard let key = Bundle.main.infoDictionary?["SUPABASE_ANON_KEY"] as? String else {
            fatalError("SUPABASE_ANON_KEY not found in Info.plist")
        }
        return key
    }()

    static let environment: String = {
        Bundle.main.infoDictionary?["DRIFT_ENVIRONMENT"] as? String ?? "Unknown"
    }()
}
```

## Setting Up Version.xcconfig

### 1. Initialize Version File

```bash
drift version set --marketing 1.0.0 --build 1
```

This creates `Version.xcconfig`:

```
// Version.xcconfig
// Managed by drift

MARKETING_VERSION = 1.0.0
CURRENT_PROJECT_VERSION = 1
```

### 2. Configure Xcode

In your target's **Build Settings**:

| Setting | Value |
|---------|-------|
| Marketing Version | `$(MARKETING_VERSION)` |
| Current Project Version | `$(CURRENT_PROJECT_VERSION)` |

Or include in your xcconfig:

```
#include "Version.xcconfig"
```

### 3. Increment Build Numbers

```bash
# Manual increment
drift version bump

# In CI/CD
drift version bump --commit --push
```

## Git Ignore

Add generated files to `.gitignore`:

```gitignore
# Drift generated files
Config.xcconfig
```

Keep `Version.xcconfig` tracked for version history.

## sourcekit-lsp Integration

For VS Code or other editors with sourcekit-lsp:

```bash
drift env setup --build-server
```

This generates `buildServer.json` for LSP support:

```json
{
  "name": "xcode build server",
  "version": "0.2",
  "languages": ["swift", "objective-c"],
  "argv": ["/Applications/Xcode.app/.../xcode-build-server"],
  "workspace": "MyApp.xcodeproj",
  "scheme": "MyApp"
}
```

### Specifying a Scheme

By default, the scheme is auto-detected based on the current environment. Use `--scheme` to specify exactly which scheme to use:

```bash
drift env setup --build-server --scheme "MyApp (Development)"
```

## Multiple Schemes

Configure environment-specific schemes in `.drift.yaml`:

```yaml
xcode:
  schemes:
    production: MyApp-Prod
    development: MyApp-Dev
    feature: MyApp
```

## Scheme Management

Use the `drift xcode` commands to manage and validate schemes.

### Listing Schemes

List all available schemes in your project:

```bash
drift xcode schemes
```

This scans both `.xcodeproj` and `.xcworkspace` files and shows:
- Shared schemes (recommended, committed to git)
- Personal schemes (local only)

### Validating Schemes

Before deploying or building, validate that configured schemes exist:

```bash
drift xcode validate
```

This checks that all schemes in your `.drift.yaml` are present in the Xcode project.

### Auto-Detection During Init

When running `drift init`, Drift automatically scans for available schemes and can suggest mappings:

1. **Production**: Schemes containing "Production", "Release", or "Prod"
2. **Development**: Schemes containing "Development", "Dev", or "Staging"
3. **Feature**: Default or Debug schemes

**Example:**

```bash
$ drift init

  ...

───── Xcode Schemes
  Found 3 schemes in MyApp.xcodeproj:
    • MyApp (Production)
    • MyApp (Development)
    • MyApp (Debug)

  Suggested mappings:
    production:  MyApp (Production)
    development: MyApp (Development)
    feature:     MyApp (Debug)

? Use suggested scheme mappings? [Y/n]
```

## See Also

- [Environment Management](../commands/env.md)
- [Version Management](../commands/version.md)
